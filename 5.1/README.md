# Домашнее задание по лекции "5.1. Введение в виртуализацию. Типы и функции гипервизоров. Обзор рынка вендоров и областей применения."
## Обязательная задача 1
Опишите кратко, как вы поняли: в чем основное отличие полной (аппаратной) виртуализации, паравиртуализации и виртуализации на основе ОС.

## Ответ
При паравиртуализации гостевая ОС знает, что работает в виртуальной среде.
Она содержит драйверы, направляющие часть команд непосредственно в ОС хоста.
Применение паравиртуализации требует модификации кода гостевой ОС на уровне ядра, что позволяет ей общаться с гипервизором на более высоком уровне, обеспечивая более высокое быстродействие.
Также паравиртуализация работает только при условии, что на хостовой и гостевой машине работают родственные операционные системы. Считается, что в настоящее время плюсы паравиртуализации практически нивелированы оптимизацией производительности со стороны разработчиков ОС и гипервизоров (паравиртуализация была хороша, но сейчас её плюсы не ощущаются).

## Обязательная задача 2
Выберите один из вариантов использования организации физических серверов, в зависимости от условий использования.

Организация серверов:

физические сервера;

паравиртуализация;

виртуализация уровня ОС.

Условия использования:

Высоконагруженная база данных, чувствительная к отказу;

Различные web-приложения;

Windows системы для использования бухгалтерским отделом;

Системы, выполняющие высокопроизводительные расчеты на GPU.

Опишите, почему вы выбрали к каждому целевому использованию такую организацию.

## Ответ
 Высоконагруженная база данных, чувствительная к отказу - физические сервера. От сервера требуется максимум производительности и максимально быстрый отклик СУБД на все запросы. Отказоустойчивость обеспечивается за счет дублирования серверов.

 Различные Java-приложения - виртуализация уровня ОС. Однотипные приложения можно разместить в изолированных контейнерах, работающих внутри одной ОС.

 Windows системы для использования Бухгалтерским отделом - физические сервера или паравиртуализация. Оба варианта имеют право на жизнь. У физического сервера несколько выше производительность, виртуальный легче поддерживать / резервно копировать / восстанавливать / мигрировать на другой хост.

 Системы, выполняющие высокопроизводительные расчеты на GPU - физические сервера или паравиртуализация (с сильной разницей по цене). С физическим сервером - максимум производительность от видеокарты, относительная доступность по цене. Паравиртуализация с пробросом видеокарты в гостевые ВМ: скорее всего, производительность будет несколько ниже, дорогие лицензии, подходят не все видеокарты, дополнительная сложность и стоимость работ по развертыванию и настройке.

## Обязательная задача 3
Выберите подходящую систему управления виртуализацией для предложенного сценария. Детально опишите ваш выбор.

Сценарии:

100 виртуальных машин на базе Linux и Windows, общие задачи, нет особых требований. Преимущественно Windows based инфраструктура, требуется реализация программных балансировщиков нагрузки, репликации данных и автоматизированного механизма создания резервных копий.
Требуется наиболее производительное бесплатное open source решение для виртуализации небольшой (20-30 серверов) инфраструктуры на базе Linux и Windows виртуальных машин.
Необходимо бесплатное, максимально совместимое и производительное решение для виртуализации Windows инфраструктуры.
Необходимо рабочее окружение для тестирования программного продукта на нескольких дистрибутивах Linux.
## Ответ
Сценарий 1. Управление множеством виртуальных машин с преимущественно Windows инфраструктурой логичнее делать в гипервизоре вендора преобладающей ОС, а именно Hyper-V. Так как продукт комменрческий, то, наверное, должен поддерживать большинство востребованных функций, например резервное копирование, реплики и балансировку нагрузки.

Сценарий 2. Для небольшого числа виртуальных машин со смешенной инфраструктурой подойдёт VirtualBox. Это кроссплатформенный бесплатный open source проект, обладающий интуитивно понятным графическим интерфейсом помимо коммандного интерфейса VBoxManage.

Сценарий 3. На лекции упоминали о принципах разработки Xen Server, как о медленно идущем, но не спотыкающемся человечке, то есть максимально стабильной и совместимой системе виртуализации (по сравнению с KVM). Для виртуализации Windows инфраструктуры наилучшим образом подойдёт Xen VP (работает в режиме паравиртуализации) из-за большей совместимости с Windows.

Сценарий 4. Если хостовый сервер построен на Linux, то логично использовать самое популярное решение, которое применяют другие, то есть KVM. На Windows можно использовать VirtualBox, который поддерживает шаблоны самых популярных дистрибутивов, а также магические "Other Linux".

## Обязательная задача 4
Опишите возможные проблемы и недостатки гетерогенной среды виртуализации (использования нескольких систем управления виртуализацией одновременно) и что необходимо сделать для минимизации этих рисков и проблем. Если бы у вас был выбор, то создавали бы вы гетерогенную среду или нет? Мотивируйте ваш ответ примерами.

## Ответ
Использование нескольких систем управления виртуализацией одновременно на одной физической системе чревато возникновением конфликта драйверов гипервизиров при доступе к аппаратным ресурсам вплоть до краха системы. Реальный пример из жизни: в хостовой системе Windows 10 использовался гипервизор VirtualBox. Для тестов потребовалось установить Docker. Как позже выяснилось, версия Docker под ОС Windows использует встроенный гипервизор Hyper-V. Во время установки происходит активация данного компонента с почти принудительной перезагрузкой системы. После перезагрузки и через несколько секунд после запуска VirtualBox происходит стабильный крах системы (экран смерти) - совместная работа невозможна. После такого опыта мне сложно представить вариант и причины почему невозможно не использовать гетерогенную среду виртуализации.

Если гетерогенная система виртуализации распределена на несколько физических систем (по одному гипервизору на каждый ПК), то это порождает сложности в обслуживании, так как системы скорее всего работают по разному, имеют разные системы команд и API, усложняется резервное копирование и т.п. Для поддержки потребуются специалист(ы) с бОльшим опытом работы, нежели при использовании одного гипервизора.

Для уменьшения рисков получения сбоев можно перенести все виртуальные машины в один гипервизор, либо разнести разные гипервизоры на разные физические компьютеры. Например, в приведённом примере Docker можно установить в отдельную виртуальную машину VirtualBox, а не на хостовую, либо на отдельный компьютер, подключенный к основному по сети.


## 
Добрый день!
Задание 1
В чём разница при работе с ядром гостевой ОС для полной и паравиртуализации?
Задание 2
2.1 Применение виртуализации в данном случае уменьшит производительность и ухудшит надёжность. Кластер можно собрать при помощи самой СУБД, без использования средств виртуализации.
2.2 Не будет проблем с кластеризацией монолитных приложений?
С уважением,
Алексей

## Ответ на "Задание 1"
Разница при работе с ядром гостевой ОС для полной и паравиртуализации состоит в том, что при паравиртуализации ОС не скрывает себя от гостевых операционных систем и все они знают что находятся в виртуальной среде и используют API для взаимодействия с функциями основной ОС.
В случае полной виртуализации немодифицированная ОС работает полностью изолированно и не осознаёт себя виртуальной машиной. 
Что касается виртуализации на основе ос, в отличие от двух выше упомянутых данный вид может использовать виртуализацию только на основе ядра установленной системы, а так же в виде докера может без проблем функционировать на любой виртуальной машине, что в свою очередь делает её не конкурентом а дополнением для полной и аппаратной виртуализации.
Паравиртуализация предусматривает использование гипервизора с отдельной хостовой ОС. Гостевые ОС в виртуальных машинах могут быть любые, поддерживаемые гипервизором.

## Ответ на "Задание 2"
Проблем не будет и 1С тому хороший пример.

